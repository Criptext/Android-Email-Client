machine:
  java:
    version: oraclejdk8
dependencies:
  cache_directories:
    - ~/.android
  pre:
    - >    
       sudo /opt/google-cloud-sdk/bin/gcloud --quiet components update
    - >
       echo $GCLOUD_SERVICE_KEY | base64 --decode > ${HOME}/gcloud-service-key.json    
    - >
       echo $GSERVICES | base64 --decode > google-services.json
    - >   
       sudo /opt/google-cloud-sdk/bin/gcloud auth activate-service-account --key-file ${HOME}/gcloud-service-key.json
    - >   
       sudo /opt/google-cloud-sdk/bin/gcloud config set project $GCLOUD_PROJECT
    - >
      if [[ ! -d "$ANDROID_HOME/sources/android-25" ]]; then
      echo y |
      android update sdk --all --no-ui
      --filter android-26 ;
      fi
    - >
      echo y |
      android update sdk --all --no-ui
      --filter tools,platform-tools
    - >
      if [[ ! -d "$ANDROID_HOME/build-tools/27.0.3" ]]; then
      echo y |
      android update sdk --all --no-ui --filter build-tools-27.0.3 ;
      fi
    - >
      if [[ ! -d "$ANDROID_HOME/extras/android/support" ]]; then
      echo y |
      android update sdk --all --no-ui
      --filter extra-android-support ;
      fi
    - >
      echo y |
      android update sdk --all --no-ui
      --filter extra-android-m2repository

